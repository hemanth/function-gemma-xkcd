(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(t){if(t.ep)return;t.ep=!0;const s=n(t);fetch(t.href,s)}})();const g=new Worker("./worker.js",{type:"module"}),d=document.getElementById("status-message"),p=document.getElementById("progress-bar"),i=document.getElementById("user-input"),y=document.getElementById("send-btn");document.getElementById("output-panel");const l=document.getElementById("thinking-indicator"),h=document.getElementById("comic-display"),u=document.getElementById("log-message"),w=document.getElementById("comic-img"),x=document.getElementById("comic-title"),E=document.getElementById("comic-alt"),b=document.getElementById("comic-num"),$=document.getElementById("comic-date");g.postMessage({type:"load"});const c=e=>{i.disabled=e,y.disabled=e,e||i.focus()};g.onmessage=e=>{const{type:o,data:n}=e.data;switch(o){case"progress":if(["init","download","progress","done","ready"].includes(n.status)){p.style.width=`${n.progress||0}%`;const a=n.customMessage||"Loading intelligence...";d.textContent=`${a} ${Math.round(n.progress||0)}%`}break;case"ready":d.textContent="System online. Ready for extraction.",p.parentElement.classList.add("hidden"),c(!1);break;case"error":d.textContent="Error: "+n,d.style.color="#ef4444",c(!1),l.classList.add("hidden");break;case"tool_call":B(n);break;case"text":f(n),c(!1);break}};async function B(e){if(e.name.includes("xkcd")){const o=e.parameters.query||"random";u.textContent=`Accessing XKCD database for: "${o}"...`;try{let n;const a="https://xkcd.hemanth.deno.net";if(o==="random"||!o||o==="0"||o===0){const r=(await(await fetch(`${a}/`)).json()).data.num,m=Math.floor(Math.random()*r)+1;n=(await(await fetch(`${a}/${m}`)).json()).data}else{const t=o.toString().match(/\d+/),s=t?t[0]:null;s&&s!=="0"?n=(await(await fetch(`${a}/${s}`)).json()).data:(u.textContent=`Invalid comic number "${o}" (fetching latest)...`,n=(await(await fetch(`${a}/`)).json()).data)}C(n)}catch(n){f("Extraction failed: "+n.message)}finally{c(!1)}}else f(`Model requested unknown tool: ${e.name}`),c(!1)}function C(e){l.classList.add("hidden"),h.classList.remove("hidden"),x.textContent=e.title,w.src=e.img,E.textContent=e.alt,b.textContent=`Comic #${e.num}`,$.textContent=`${e.day}/${e.month}/${e.year}`,c(!1)}function f(e){l.classList.add("hidden"),d.textContent=e,c(!1)}const I=()=>{const e=i.value.trim();!e||y.disabled||(c(!0),h.classList.add("hidden"),l.classList.remove("hidden"),u.textContent="Analyzing intent...",g.postMessage({type:"generate",data:e}),i.value="")};y.onclick=I;i.onkeydown=e=>{e.key==="Enter"&&I()};
